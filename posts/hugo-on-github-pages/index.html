<!doctype html><html lang=ja>
<head>
<title>Github PagesにHugoをデプロイする :: blog</title>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="目次 前置き 背景 選定 やっていき 設計 実装 Hugo GitHubActions GitHub Pagesの設定 完走した感想 前置き 背景 gistなどで管理していたもろもろのメモをもうちょっときれいに見せたくなったので、ブログ形式で残すことにしました。 が、今日日どっかのブログサービスもなーでも自前でWordPressなんかもちょっとキツいなーという感じです。 これだけで伝わらないと思うので、気持ち的な要件をリストアップすると、こんな感じ。 テキストがブラウザ">
<meta name=keywords content>
<meta name=robots content="noodp">
<link rel=canonical href=/posts/hugo-on-github-pages/>
<link rel=stylesheet href=/assets/style.css>
<link rel=stylesheet href=/assets/blue.css>
<link rel=apple-touch-icon href=/img/apple-touch-icon-192x192.png>
<link rel="shortcut icon" href=/img/favicon/blue.png>
<meta name=twitter:card content="summary">
<meta name=twitter:site content>
<meta name=twitter:creator content="_kei_s">
<meta property="og:locale" content="ja">
<meta property="og:type" content="article">
<meta property="og:title" content="Github PagesにHugoをデプロイする">
<meta property="og:description" content="目次 前置き 背景 選定 やっていき 設計 実装 Hugo GitHubActions GitHub Pagesの設定 完走した感想 前置き 背景 gistなどで管理していたもろもろのメモをもうちょっときれいに見せたくなったので、ブログ形式で残すことにしました。 が、今日日どっかのブログサービスもなーでも自前でWordPressなんかもちょっとキツいなーという感じです。 これだけで伝わらないと思うので、気持ち的な要件をリストアップすると、こんな感じ。 テキストがブラウザ">
<meta property="og:url" content="/posts/hugo-on-github-pages/">
<meta property="og:site_name" content="blog">
<meta property="og:image" content="/">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">
<meta property="article:section" content="技術">
<meta property="article:published_time" content="2022-02-21 01:00:00 +0900 +0900">
</head>
<body class=blue>
<div class="container center headings--one-size">
<header class=header>
<div class=header__inner>
<div class=header__logo>
<a href=/>
<div class=logo>
blog
</div>
</a>
</div>
<div class=menu-trigger>menu</div>
</div>
<nav class=menu>
<ul class="menu__inner menu__inner--desktop">
<li><a href=/categories>カテゴリ</a></li>
<li><a href=/tags>タグ</a></li>
<li><a href=/archives>月別アーカイブ</a></li>
</ul>
<ul class="menu__inner menu__inner--mobile">
<li><a href=/categories>カテゴリ</a></li>
<li><a href=/tags>タグ</a></li>
<li><a href=/archives>月別アーカイブ</a></li>
</ul>
</nav>
</header>
<div class=content>
<div class=post>
<h1 class=post-title>
<a href=/posts/hugo-on-github-pages/>Github PagesにHugoをデプロイする</a></h1>
<div class=post-meta>
<span class=post-date>
2022-02-21
</span>
<span class=post-author>:: kei</span>
</div>
<span class=post-tags>
#<a href=/tags/hugo/>Hugo</a>&nbsp;
#<a href=/tags/github/>GitHub</a>&nbsp;
</span>
<div class=post-content><div>
<h2 id=目次>目次<a href=#目次 class=hanchor arialabel=Anchor>&#8983;</a> </h2>
<ol>
<li><a href=#%E5%89%8D%E7%BD%AE%E3%81%8D>前置き</a>
<ol>
<li><a href=#%E8%83%8C%E6%99%AF>背景</a></li>
<li><a href=#%E9%81%B8%E5%AE%9A>選定</a></li>
</ol>
</li>
<li><a href=#%E3%82%84%E3%81%A3%E3%81%A6%E3%81%84%E3%81%8D>やっていき</a>
<ol>
<li><a href=#%E8%A8%AD%E8%A8%88>設計</a></li>
<li><a href=#%E5%AE%9F%E8%A3%85>実装</a>
<ol>
<li><a href=#hugo>Hugo</a></li>
<li><a href=#github-actions>GitHubActions</a></li>
<li><a href=#github-pages%E3%81%AE%E8%A8%AD%E5%AE%9A>GitHub Pagesの設定</a></li>
</ol>
</li>
</ol>
</li>
<li><a href=#%E5%AE%8C%E8%B5%B0%E3%81%97%E3%81%9F%E6%84%9F%E6%83%B3>完走した感想</a></li>
</ol>
<h2 id=前置き>前置き<a href=#前置き class=hanchor arialabel=Anchor>&#8983;</a> </h2>
<h3 id=背景>背景<a href=#背景 class=hanchor arialabel=Anchor>&#8983;</a> </h3>
<p>gistなどで管理していたもろもろのメモをもうちょっときれいに見せたくなったので、ブログ形式で残すことにしました。<br>
が、今日日どっかのブログサービスもなーでも自前でWordPressなんかもちょっとキツいなーという感じです。<br>
これだけで伝わらないと思うので、気持ち的な要件をリストアップすると、こんな感じ。</p>
<ol>
<li>テキストがブラウザ上で快適に読める状態であればそれでいい。コメントとかいらない。</li>
<li>特定のサービスに依存する形にしたくない。なにかあったときは最悪自前で気楽に(ここ重要)ホスティングできるようにしたい。</li>
<li>セキュリティ周りをなるべく意識したくない。ログイン画面隠したりCMSのバージョン気にしたりしたくない。</li>
</ol>
<p>もうこれ、静的サイトジェネレーター(SSG)しかないじゃん、ということで、そうしました。</p>
<h3 id=選定>選定<a href=#選定 class=hanchor arialabel=Anchor>&#8983;</a> </h3>
<p>候補は2つありました。<br>
1つは<a href=https://www.getzola.org/>Zola</a>。Rust製のSSGツールになります。<br>
もうひとつは<a href=https://gohugo.io/>Hugo</a>。こちらはGo製。<br>
どちらもmarkdownのテキストファイルからブログの形をしたhtmlを吐き出してくれるツールです。<br>
ドキュメントをさっと読んだ感じではZolaもHugoも機能的にはあまり差がなさそうでした。開発の活発度合いも変わりなく、強いて言えば数年先行しているHugoのほうが英語・日本語ともにドキュメントが見つかりやすい雰囲気です。<br>
<del>宗教</del>好みで言えばZolaですが、今回はサクっとやってしまいたかったので、Hugoをチョイスしました。</p>
<p>サーバというか配信にはGitHub Pagesを使用することにします。<br>
無料だしGitHub Actionsでいろいろできるし、なにより必然的にGitHubリポジトリで管理する = 手持ちの端末どれからでも投稿ができる。</p>
<h2 id=やっていき>やっていき<a href=#やっていき class=hanchor arialabel=Anchor>&#8983;</a> </h2>
<h3 id=設計>設計<a href=#設計 class=hanchor arialabel=Anchor>&#8983;</a> </h3>
<p><img src=/images/hugo-on-github-pages/githubpages.png alt=全体の図></p>
<p>こんな感じにすることにします。<br>
mdファイル(というかソース)を管理するリポジトリと、公開用のリポジトリを分けているのは、なんとなくです。分ける必要もないと思うっちゃ思うのですが、せっかくだからわけることにしました。やったことでゴミみたいなコミットしてるのが外には見えないのでそれはメリットかも。</p>
<h3 id=実装>実装<a href=#実装 class=hanchor arialabel=Anchor>&#8983;</a> </h3>
<h4 id=hugo>Hugo<a href=#hugo class=hanchor arialabel=Anchor>&#8983;</a> </h4>
<p>Hugo側の設定はあまり気にすることがありません。<br>
強いて言えばテーマをどう管理するかくらいですが、外部テーマを使う場合はgit submoduleを使うことが推奨されているようです。<br>
今回私が選んだテーマは<a href=https://github.com/panr/hugo-theme-terminal>panr/hugo-theme-terminal</a>です。こちらもREADMEにて手の込んだ改変をしない限りはgit submoduleを使うことを推奨していました。テーマを触る気はいまのところあんまりないので、submoduleを利用するパターンを採用します。</p>
<h4 id=github-actions>GitHub Actions<a href=#github-actions class=hanchor arialabel=Anchor>&#8983;</a> </h4>
<p>GitHub Actions、つまりはデプロイ=記事の投稿です。<br>
<a href=https://rmoff.net/2020/12/20/scheduling-hugo-builds-on-github-pages-with-github-actions/>Scheduling Hugo Builds on GitHub pages with GitHub Actions</a>という記事を参考に、ちょっと手を入れたデプロイを組んでいます。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=color:#f92672>on</span>:
  <span style=color:#f92672>push</span>:
    <span style=color:#f92672>branches</span>:
      - <span style=color:#ae81ff>main</span>

<span style=color:#f92672>jobs</span>:
  <span style=color:#f92672>build-and-deploy</span>:
    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>ubuntu-latest</span>
    <span style=color:#f92672>steps</span>:
      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>checkout source</span>
        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/checkout@v2</span>
        <span style=color:#f92672>with</span>:
          <span style=color:#f92672>submodules</span>: <span style=color:#66d9ef>true</span>
          <span style=color:#f92672>fetch-depth</span>: <span style=color:#ae81ff>0</span>
      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>remove .gitignore</span>
        <span style=color:#f92672>run</span>: <span style=color:#ae81ff>rm ./.gitignore</span>
      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>setup hugo</span>
        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>peaceiris/actions-hugo@v2</span>
        <span style=color:#f92672>with</span>:
          <span style=color:#f92672>hugo-version</span>: <span style=color:#e6db74>&#39;latest&#39;</span>
      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>build</span>
        <span style=color:#f92672>run</span>: <span style=color:#ae81ff>hugo --minify</span>
      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>copy verify files to public</span>
        <span style=color:#f92672>run</span>: <span style=color:#ae81ff>cp ./verify/* ./public</span>
      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>deploy</span>
        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>peaceiris/actions-gh-pages@v3</span>
        <span style=color:#f92672>if</span>: <span style=color:#ae81ff>${{ github.ref == &#39;refs/heads/main&#39; }}</span>
        <span style=color:#f92672>with</span>:
          <span style=color:#f92672>deploy_key</span>: <span style=color:#ae81ff>${{ secrets.ACTIONS_DEPLOY_KEY }}</span>
          <span style=color:#f92672>external_repository</span>: <span style=color:#ae81ff>kei-s16/kei-s16.github.io</span>
          <span style=color:#f92672>publish_dir</span>: <span style=color:#ae81ff>./public</span>
          <span style=color:#f92672>publish_branch</span>: <span style=color:#ae81ff>main</span>
</code></pre></div><p>やっていることは元記事と同じくhugoでビルドして、公開用リポジトリにpushしているだけです。<br>
違うところはといえば、</p>
<ul>
<li>私の場合はgitignoreでソースリポジトリに生成物を持たない(public以下を持たない)ようにしているため、そこをごにょごにょするための処理を追加した</li>
<li>GitHub Pagesで独自ドメインを当てたり、keybaseの認証をしたりするのに必要なファイル(verify以下)を一緒にデプロイしている</li>
<li>公開リポジトリには生成物(public以下)しか持たないようにした</li>
</ul>
<p>の3点です。<br>
上記のコードにより、mainブランチにmdファイルやらなにやらをマージすることで、公開リポジトリにhtmlファイルを送りつけてくれるようになりました。</p>
<h4 id=github-pagesの設定>GitHub Pagesの設定<a href=#github-pagesの設定 class=hanchor arialabel=Anchor>&#8983;</a> </h4>
<p><code>{ユーザ名}.github.io</code>ドメインのままで問題なければ、リポジトリのsettingsからpagesを有効にするだけです。<br>
独自ドメインを当てたい場合は公式ドキュメントを参考にしつつ、<code>{ユーザ名}.github.io</code> に対する独自ドメインのCNAMEレコードを作成してください。<br>
注意が必要なのが、ドメインの検証に時間がかかることと、HTTPSでの接続を有効にするのにさらに時間がかかることです。時間に余裕を持って作業しましょう。</p>
<h2 id=完走した感想>完走した感想<a href=#完走した感想 class=hanchor arialabel=Anchor>&#8983;</a> </h2>
<ul>
<li>Pull-Requestベースで管理できるのめっちゃ楽</li>
<li>vimで書けるのめっちゃ楽</li>
<li>DBのバージョンとかPHPのバージョンとかCMSのバージョンとかプラグインのバージョンとか気にしなくていいのほんと楽</li>
</ul>
</div></div>
<div class=pagination>
<div class=pagination__title>
<span class=pagination__title-h>read other posts</span>
<hr>
</div>
<div class=pagination__buttons>
<span class="button next">
<a href=/posts/furikaeri-2021/>
<span class=button__text>2021年のふりかえり</span>
<span class=button__icon>→</span>
</a>
</span>
</div>
</div>
</div>
</div>
<footer class=footer>
<div class=footer__inner>
<div class=copyright>
<span>© 2022 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span>
</div>
</div>
</footer>
<script src=/assets/main.js></script>
<script src=/assets/prism.js></script>
</div>
</body>
</html>